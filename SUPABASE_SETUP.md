# Configuración de Supabase

Para que la aplicación funcione correctamente, necesitas configurar tu proyecto en Supabase.

## 1. Crear Proyecto
Ve a [Supabase](https://supabase.com/) y crea un nuevo proyecto.

## 2. Obtener Credenciales
En los ajustes de tu proyecto (Settings > API), copia:
- Project URL
- anon / public Key

Pega estos valores en el archivo `.env` en la raíz del proyecto:
```env
VITE_SUPABASE_URL=tu_url_aqui
VITE_SUPABASE_ANON_KEY=tu_key_aqui
```

## 3. Crear Tablas (SQL Editor)
Ve al "SQL Editor" en Supabase y ejecuta el siguiente código para crear las tablas necesarias:

```sql
-- Tabla de Equipos
create table public.equipos (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  name text not null,
  brand text,
  model text,
  quantity integer default 0,
  acquisition_date date,
  specs jsonb default '{}'::jsonb
);

-- Tabla de Feedback
create table public.feedback (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  message text not null,
  email text
);

-- Habilitar acceso público (Opcional para desarrollo rápido, idealmente configurar RLS)
alter table public.equipos enable row level security;
alter table public.feedback enable row level security;

create policy "Acceso total a equipos"
on public.equipos
for all
using (true);

create policy "Insertar feedback"
on public.feedback
for insert
with check (true);

-- Tabla de Historial de Cálculos
create table public.history (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  tool_name text not null,
  label text,
  data jsonb not null
);

alter table public.history enable row level security;

create policy "Acceso total a historial"
on public.history
for all
using (true);

-- ACTUALIZACIÓN: Seguridad y Usuarios (Ejecutar esto para habilitar aislamiento por usuario)

-- 1. Agregar columna user_id a equipos
alter table public.equipos add column if not exists user_id uuid references auth.users not null default auth.uid();

-- 2. Agregar columna user_id a history
alter table public.history add column if not exists user_id uuid references auth.users not null default auth.uid();

-- 3. Actualizar Políticas de Seguridad (RLS) para Equipos
alter table public.equipos enable row level security;

drop policy if exists "Acceso total a equipos" on public.equipos;

create policy "Usuarios ven sus propios equipos"
on public.equipos for select
using (auth.uid() = user_id);

create policy "Usuarios insertan sus propios equipos"
on public.equipos for insert
with check (auth.uid() = user_id);

create policy "Usuarios actualizan sus propios equipos"
on public.equipos for update
using (auth.uid() = user_id);

create policy "Usuarios eliminan sus propios equipos"
on public.equipos for delete
using (auth.uid() = user_id);

-- 4. Actualizar Políticas de Seguridad (RLS) para Historial
alter table public.history enable row level security;

drop policy if exists "Acceso total a historial" on public.history;

create policy "Usuarios ven su propio historial"
on public.history for select
using (auth.uid() = user_id);

create policy "Usuarios insertan su propio historial"
on public.history for insert
with check (auth.uid() = user_id);

-- 5. Agregar columna de descripción (Para contexto adicional)
alter table public.history add column if not exists description text;
```

## 4. Ejecutar el Proyecto
```bash
npm run dev
```
